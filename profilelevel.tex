\label{profilelevel}

A compliant Dirac decoder may support a number of different profiles and levels, which determine 
which tools, syntax elements and structures are to be supported, and what decoder resources 
(computational and memory) are required. Profiles deal largely with the former and levels
with the latter, although in particular in a software implementation, the choice of supported tools
also affects decoder resources. Level constraints are expressed in terms of picture sizes and 
formats 

A particular profile will require that particular syntax/syntax elements be used and that decoder
variables or functions are set to particular values. Currently only two profiles are defined, Main and Low-Delay. Low-delay profile corresponds to a decoder capable of decoding the low-delay syntax only. 
Main profile corresponds to a decoder capable of decoding the both the core syntax and low-delay syntax.

Levels determine the size of the
decoded picture buffer $\DecodedBuffer$ and the stream buffer for data entering the decoder. Levels
apply differently in Low-Delay and Main profile, as buffering requirements are quite different (and much
less demanding) for Low-Delay operation.
The operation of these buffers is described in Sections \ref{decodedbufferop} and \ref{streambufferop}.

\subsection{Decoded picture buffer model operation}
\label{decodedbufferop}

In order to define compliance with level and profile requirements, a model of decoded picture buffer
operation is specified.

The decoded picture buffer (DPB) $\DecodedBuffer$ exists to allow for pictures to be presented in display, or 
picture number, order whilst pictures are coded out of order. No constraints are placed on the order
of pictures within a Dirac stream provided that reordering can be carried out within the given size of
the DPB. The DPB size is the minimum delay required by the decoder, ignoring decoding time and stream
buffering delays (Section \ref{streambufferop}).

Note that the DPB is distinct from the reference picture buffer, and the removal of pictures from,
or placement in, the DPB is wholly independent in this specification, although in practice shared
storage may be employed.

Pictures are deemed to be output from the decoder and placed in the DPB instantaneously at multiples
of the (real number) picture sample interval $\PictureInterval$. This interval is defined as follows:
\begin{itemize}
\item if $\Interlaced$ is $\true$ and $\SequentialFields$ is $\true$ (i.e. pictures are fields) then 
\begin{equation*}
\PictureInterval=\dfrac{\FrameRateDenominator}{2*\FrameRateNumerator}
\end{equation*}
\item otherwise (i.e. pictures are frames) then 
\begin{equation*}
\PictureInterval=\dfrac{\FrameRateDenominator}{\FrameRateNumerator}
\end{equation*}
\end{itemize}

If a picture is output from the DPB, it is deemed to occur at the same instant as a picture is
added, resulting in no net increase in DPB occupancy.

A decoder may access a Dirac stream at an AU header. Let $N_n$ denote
the picture number of the $r$th picture in coded order after
the AU header, with $N_0=\AUPictureNumber$. Picture decoding/parsing 
is deemed to start at this point. 

In case $\DPBSize$ is 0, the picture output at time $t_0+n*\PictureInterval$
shall be the picture decoded at time $n*\PictureInterval$. In this case
the picture numbers of pictures output by the decoder shall increment
by 1 with each picture decoded, and form a contiguous sequence of integers.

In case $\DPBSize>0$, a compliant stream shall satisfy the following
conditions
\begin{enumerate}
\item For $k\geq 0$, there exists some $n$ with $N_n=P_0+k$ with
\[k\leq n\leq k+\DPBSize+2\]
\item For $n\geq\DPBSize+2$, picture $N_n$ is decodeable 
using only data received subsequent to the AU header
\end{enumerate}

These conditions are sufficient to ensure that a buffer of size $\DPBSize$
is sufficient to reorder all pictures to produce a stream of pictures
with contiguous picture numbers, and these pictures shall be capable of being fully 
decoded and displayed after a delay equal to at most $\DPBSize+2$ picture intervals.

\begin{informative*}
\subsubsection{Example operation (Informative)}
Consider a conventional MPEG-2 style `IBBP' Group of Pictures (GOP), consisting
of intra pictures (I), forward-predicted pictures (P) and bi-directionally
predicted pictures (B). In picture order, this is
\[\ldots\ I_{N_0}\ B_{N_0+1}\ B_{N_0+2}\ P_{N_0+3}\ B_{N_0+4}\ B_{N_0+5}\ 
P_{N_0+6}\ B_{N_0+7}\ B_{N_0+8}\ P_{N_0+9}\ B_{N_0+10}\ B_{N_0+11}\ I_{N_0+12}
\ B_{N_0+13}\ \ldots\]

Each P-picture is predicted from the previous P or I picture, and each B-picture
from the previous and subsequent P- or I-picture. Hence coded order is:
\[\ldots\ I_{N_0}\ B_{N_0-2}\ B_{N_0-1}\ P_{N_0+3}\ B_{N_0+1}\ B_{N_0+2}\ 
P_{N_0+6}\ B_{N_0+4}\ B_{N_0+5}\ P_{N_0+9}\ B_{N_0+7}\ B_{N_0+8}\ I_{N_0+12} 
\ B_{N_0+10}\ B_{N_0+11}\ \ldots\]
with random access at each intra picture. A decoder accessing the stream at
$I_{N_0}$ would require a buffer of 2 pictures, since B-pictures can be
displayed immediately. The DPB would operate as follows:
\begin{enumerate}
\item Time $t_0$. \\
Receive $I_{N_0}$ and store in the DPB.\\
DPB=$\{I_{N_0}\}$\\
Displayed picture=
\item Time $t_0+\PictureInterval$. \\
Receive $B_{N_0-2}$ (undecoded) and discard:\\
DPB=$\{I_{N0}\}$\\
Displayed picture=
\item Time $t_0+2*\PictureInterval$. \\
Receive $B_{N_0-1}$ (undecoded) and discard:\\
DPB=$\{I_{N0}\}$\\
Displayed picture=
\item Time $t_0+3*\PictureInterval$. \\
Receive $P_{N_0+3}$ (decoded) and place in DPB, 
display $I_{N_0}$ and remove from DPB:\\
DPB=$\{P_{N_0+3}\}$\\
Displayed picture=$I_{N_0}$
\item Time $t_0+4*\PictureInterval$. \\
Receive $B_{N_0+1}$ (decoded) and display immediately:\\
DPB=$\{P_{N_0+3}\}$\\
Displayed picture=$B_{N_0+1}$
\item Time $t_0+5*\PictureInterval$. \\
Receive $B_{N_0+2}$ (decoded) and display immediately:\\
DPB=$\{P_{N_0+3}\}$\\
Displayed picture=$B_{N_0+2}$
\item Time $t_0+6*\PictureInterval$. \\
Receive $P_{N_0+6}$ (decoded) and place in DPB, display 
$P_{N_0+3}$ and remove from the DPB:\\
DPB=$\{P_{N_0+6}\}$\\
Displayed picture=$P_{N_0+3}$
\item Time $t_0+7*\PictureInterval$. \\
Receive $B_{N_0+4}$ (decoded) and display immediately:\\
DPB=$\{P_{N_0+6}\}$\\
Displayed picture=$B_{N_0+4}$
\item Time $t_0+8*\PictureInterval$. \\
Receive $B_{N_0+5}$ (decoded) and display immediately:\\
DPB=$\{P_{N_0+6}\}$\\
Displayed picture=$B_{N_0+5}$
\item Time $t_0+9*\PictureInterval$. \\
Receive $P_{N_0+9}$ (decoded) and place in DPB, display 
$P_{N_0+6}$ and remove from the DPB:\\
DPB=$\{P_{N_0+9}\}$\\
Displayed picture=$P_{N_0+6}$
\item $\ldots$
\end{enumerate}

Note that a better subjective experience can be gleaned if the
decoder outputs the initial intra frame $I_{N_0}$ whilst buffering
pictures initially.

\end{informative*}

\subsection{Stream buffer model operation}
\label{streambufferop}

In order to define compliance with level and profile requirements, a model of decoded picture buffer
operation is specified.

The decoder stream buffer (DSB) $\StreamBuffer$ exists to allow for data to be transmitted at a constant bit
rate (CBR), yet consist of varying bit allocations to individual pictures. It is well-known that input buffers
operate in mirror-image to output buffers, and so the specification of the ISB implicitly defines
how an identically-sized encoder stream buffer (ESB) would operate to ensure correct CBR operation, although
in practice some encoder-side headroom may be required.

[TBC]

\subsection{Supported levels}
[TBC]
