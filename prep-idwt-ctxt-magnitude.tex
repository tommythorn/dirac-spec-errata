This section specifies the procedure for choosing contexts for decoding
the magnitude of a coefficient in position (x,y) in the subband.

Neighbourhood sum

A value NHOOD\_SUM is defined as the sum of the absolute values of
previously decoded and reconstructed coefficients:



A value NTOP is defined by the recipe

NTOP=(SCALE\_FACTOR>>1)*QF[j][i]

Parent flag

A Boolean flag PARENT\_ZERO is set to TRUE if the subband has a parent
subband and the parent coefficient at position (x>>1,y>>1) in that
subband is zero. 

PARENT\_ZERO is set to FALSE if the subband has a parent subband and the
parent coefficient at position (x>>1,y>>1) in that subband is not zero.

If the subband does not have a parent subband then if PARENT\_ZERO is FALSE for all
coefficients in the subband. 

Context selection

Magnitude contexts are selected by bin and, PARENT\_ZERO value and
NHOOD\_SUM value, according to .


Subband coefficient magnitude contexts

PARENT\_ZERO=TRUE

PARENT\_ZERO=FALSE

Bin       NHOOD\_SUM     Context

  1                  0                         Z\_BIN1z\_CTX

  1                 >0                        Z\_BIN1nz\_CTX

  2                 -                           Z\_BIN2\_CTX

  3                 -                           Z\_BIN3\_CTX

  4                 -                           Z\_BIN4\_CTX

  ≥5               -                           Z\_BIN5+\_CTX

Bin       NHOOD\_SUM     Context

  1                  0                         NZ\_BIN1z\_CTX

  1                 >0,≤NTOP          NZ\_BIN1a\_CTX

  1                 >NTOP               NZ\_BIN1b\_CTX

  2                 -                          NZ\_BIN2\_CTX

  3                 -                          NZ\_BIN3\_CTX

  4                 -                          NZ\_BIN4\_CTX

  ≥5               -                          NZ\_BIN5+\_CTX 


Table   Contexts for coefficient magnitude decoding


